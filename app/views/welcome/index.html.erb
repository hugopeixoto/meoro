<div id="slider"></div>
<div id="min" value="0">0</div>
<div id="max" value="100">100</div>
<div id="betButtons">
	<div class="betButton" id="bet1" onClick="bet(1);"></div>
	<div class="betButton" id="bet5" onClick="bet(5);"></div>
</div>
<div id="textStuffs">le poo</div>
<div id="userName"></div>
<div id="userBalance"></div>

<script>
	var minSlide = 1;
  var maxSlide = 100;

  userInfo();

	$(function() {
		  $("#slider").slider({
		    range: true,
		    min: minSlide,
		    max: maxSlide,
		    step: 0,
		    values: [minSlide, maxSlide],
		    slide: function(event, ui) {
		        var delay = function() {
				var label;
		            if(minSlide != parseInt(ui.values[0], 10)){
				          label = "#min";
				       }
				       else if(maxSlide != parseInt(ui.values[1], 10)) {
				          label = "#max";
				       }
		            $(label).html(ui.value).position({
		                my: 'center top',
		                at: 'center bottom',
		                of: ui.handle,
		                offset: "0, 10"
		            });

		            $(label).val(ui.value);
		        };
		        
		        // wait for the ui.handle to set its position
		        setTimeout(delay, 5);
		    },
		    stop: function(event, ui){
		        minSlide = parseInt(ui.values[0], 10);
		        maxSlide = parseInt(ui.values[1], 10);               
		    }
		});

		$('#min').html($('#slider').slider('values', 0)).position({
		    my: 'center top',
		    at: 'center bottom',
		    of: $('#slider a:eq(0)'),
		    offset: "0, 10"
		});
		$("#min").val(minSlide);

		$('#max').html($('#slider').slider('values', 1)).position({
		    my: 'center top',
		    at: 'center bottom',
		    of: $('#slider a:eq(1)'),
		    offset: "0, 10"
		});
		$("#max").val(maxSlide);
	});

	function bet(value)
	{
		console.log("betting " + value + " on range " + $("#min").val() + " to " + $("#max").val());
		$.ajax({
	        type:"POST",
	        url: "/api/v1/bets",
	        data: {
	        	user:{
	        		token: "<%= @user.token %>"
	        	}, 
	        	bet:{
	        		amount: value,
	        		high: $("#max").val(),
	        		low: $("#min").val()
	        	}
	        },
	        dataType: 'json',
	        success: function (result) {
            $('#userName').html(result.user.name);
            $('#userBalance').html(result.user.balance);
	        },
	        error: function (xhr, ajaxOptions, thrownError) {
	        	console.log("woops...");
	        }
	    });
  };

  function userInfo()
  {
    $.ajax({
      type: "GET",
      url: "/api/v1/users/<%= @user.token %>",
      dataType: 'json',
      success: function (result) {
        $('#userName').html(result.name);
        $('#userBalance').html(result.balance);
      },
      error: function (xhr, ajaxOptions, thrownError) {
        console.log("woops...");
      }
    });
  }
</script>
